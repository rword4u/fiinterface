!function(){var r=function(r,n){for(var t={},e=t,o=0,i=r.length-1;i>o;o++)e=e[r[o]]={};return e[r[o]]=n,t},n=new function(){function n(r){return r instanceof Date?r.getTime():r}function t(r){return r?0:-1}var e=this.priority=function(r,t){for(var e=r.exprs,o=0,i=0,u=e.length;u>i;i++){var f,s=e[i];if(!~(f=s.e(s.v,n(t),t)))return-1;o+=f}return o},o=this.parse=function(n,t){n||(n={$eq:n});var f=[];if("[object Object]"===Object.prototype.toString.call(n))for(var a in n){var c;if(u[a])c=a;else{if("$"===a.substr(0,1))throw new Error("Unknown operator.");c="$trav"}var v=n[a],p=v;if(i[c]){if(~a.indexOf(".")){var $=a.split(".");a=$.shift(),p=v=r($,v)}if(v instanceof Array){p=[];for(var l=v.length;l--;)p.push(o(v[l]))}else p=o(v,a)}f.push(s(c,a,p))}else f.push(s("$eq",a,n));var d={exprs:f,k:t,test:function(r){return!!~d.priority(r)},priority:function(r){return e(d,r)}};return d},i=this.traversable={$and:!0,$or:!0,$nor:!0,$trav:!0,$not:!0},u=this.testers={$eq:function(r,n){return t(r.test(n))},$ne:function(r,n){return t(!r.test(n))},$lt:function(r,n){return t(r>n)},$gt:function(r,n){return t(n>r)},$lte:function(r,n){return t(r>=n)},$gte:function(r,n){return t(n>=r)},$exists:function(r,n){return t(r===(null!=n))},$in:function(r,n){if(!(n instanceof Array))return t(~r.indexOf(n));for(var e=n.length;e--;)if(~r.indexOf(n[e]))return e;return-1},$not:function(r,n){if(!r.test)throw new Error("$not test should include an expression, not a value. Use $ne instead.");return t(!r.test(n))},$type:function(r,n,e){return e?t(e instanceof r||e.constructor==r):-1},$nin:function(r,n){return~u.$in(r,n)?-1:0},$mod:function(r,n){return n%r[0]==r[1]?0:-1},$all:function(r,n){n||(n=[]);for(var t=r.length;t--;){var e=r[t],o=~n.indexOf(e);if(!o)return-1}return 0},$size:function(r,n){return n?t(r==n.length):-1},$or:function(r,n){for(var o=r.length,i=o;o--;)if(~e(r[o],n))return o;return t(0==i)},$nor:function(r,n){for(var t=r.length;t--;)if(~e(r[t],n))return-1;return 0},$and:function(r,n){for(var t=r.length;t--;)if(!~e(r[t],n))return-1;return 0},$trav:function(r,n){if(n instanceof Array){for(var t=n.length;t--;){var o=n[t];if(o[r.k]&&~e(r,o[r.k]))return t}return-1}return e(r,n?n[r.k]:void 0)},$regex:function(r,n){var t=new RegExp(r);return t.test(n)?0:-1}},f={$eq:function(r){var n;return r instanceof RegExp?r:(n=r instanceof Function?r:function(n){return n instanceof Array?~n.indexOf(r):r==n},{test:n})},$ne:function(r){return f.$eq(r)}},s=function(r,t,e){var o=n(e);return{k:t,v:f[r]?f[r](o):o,e:u[r]}}},t=function(r){if(!r)return function(r){return r};if("function"==typeof r)return r;throw new Error("Unknown sift selector "+r)},e=function(r,t){var e=n.parse(r),o=function(r){for(var n,o,i,u=[],f=0,s=r.length;s>f;f++)o=r[f],n=t(o),~(i=e.priority(n))&&u.push(o);return u};return o.test=e.test,o.score=e.priority,o.query=r,o},o=function(r,n,o){"object"!=typeof n&&(o=n,n=void 0);var i=e(r,t(o));return n?i(n):i};o.use=function(r){r.operators&&o.useOperators(r.operators),"function"==typeof r&&r(o)},o.useOperators=function(r){for(var n in r)o.useOperator(n,r[n])},o.useOperator=function(r,t){var e={};e="object"==typeof t?t:{test:t};var o="$"+r;n.testers[o]=e.test,(e.traversable||e.traverse)&&(n.traversable[o]=!0)},"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=o:"undefined"!=typeof window&&(window.sift=o)}();